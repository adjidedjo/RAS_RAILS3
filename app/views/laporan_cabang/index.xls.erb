<div class="clear"></div>
<br /><h1>Annual Weekly Sales Report</h1><br />

<%= form_tag laporan_cabang_weekly_report_path, :method => 'get' do %>
  <br />
  <p>
    <%= label_tag 'Periode' %>
    <%= text_field_tag 'periode_week', nil, :class => "input_form" %>
  </p>
  <br />
  <p>
    <%= submit_tag "Search", :class => "button" %>
  </p>
<% end %>
<br />
<div class="clear"></div>

<% unless params[:periode_week].nil? || params[:periode_week].empty? %>
  <table id="weekly_report_sales" class="pretty">
    <p>WEEKLY SALES REPORT</p>
    <p><%= @periode.strftime('%B %Y')  %></p><br />
    <p>Elite Brand</p><br />
    <thead>
      <tr>
        <th rowspan="3">Branches</th>
      </tr>
      <tr>
        <th colspan="7">Serenity</th>
        <th colspan="7">Non Serenity</th>
      </tr>
      <tr>
        <% get_week_number = @periode.cweek - @periode.beginning_of_month.cweek + 1 %>
        <th>Week 1 </br><%= @periode.strftime('%B %Y') %></th>
        <th>Week 2 </br><%= @periode.strftime('%B %Y') %></th>
        <th>Week 3 </br><%= @periode.strftime('%B %Y') %></th>
        <th>Week 4 </br><%= @periode.strftime('%B %Y') %></th>
        <th>Week 5 </br><%= @periode.strftime('%B %Y') %></th>
        <th>Week <%= get_week_number %> </br><%= (@periode - 1.months).strftime('%B %Y') %></th>
        <th>Growth</th>
        <th>Week 1 </br><%= @periode.strftime('%B %Y') %></th>
        <th>Week 2 </br><%= @periode.strftime('%B %Y') %></th>
        <th>Week 3 </br><%= @periode.strftime('%B %Y') %></th>
        <th>Week 4 </br><%= @periode.strftime('%B %Y') %></th>
        <th>Week 5 </br><%= @periode.strftime('%B %Y') %></th>
        <th>Week <%= get_week_number %> </br><%= (@periode - 1.months).strftime('%B %Y') %></th>
        <th>Growth</th>
      </tr>
    </thead>
    <tfoot>
      <tr>
        <th scope="row">Total</th>
        <% (1..14).each do  %>
          <td></td>
        <% end %>
      </tr>
    </tfoot>
    <tbody>
      <% @cabang_get_id.each do |cabang| %>
        <tr>
          <% laporan_cabang_by_cabang =  cabang.laporan_cabang %>
          <th scope="row"><%= cabang.Cabang.gsub(/Cabang/, "") %></th>
          <% laporan_cabang_by_cabang.weekly_sum_value("Serenity", @first_day_week_1, @last_day_week_1).each do |week_1| %>
            <% @week1 = week_1.sum_harganetto2.nil? ? 0 : week_1.sum_harganetto2 %>
            <td><%= currency(@week1) %></td>
          <% end %>
          <% laporan_cabang_by_cabang.weekly_sum_value("Serenity", @first_day_week_2, @last_day_week_2).each do |week_2| %>
            <% @week2 = week_2.sum_harganetto2.nil? ? 0 : week_2.sum_harganetto2 %>
            <td><%= currency(@week2) %></td>
          <% end %>
          <% laporan_cabang_by_cabang.weekly_sum_value("Serenity", @first_day_week_3, @last_day_week_3).each do |week_3| %>
            <% @week3 = week_3.sum_harganetto2.nil? ? 0 : week_3.sum_harganetto2 %>
            <td><%= currency(@week3) %></td>
          <% end %>

          <% laporan_cabang_by_cabang.weekly_sum_value("Serenity", @first_day_week_4, @last_day_week_4).each do |week_4| %>
            <% @week4 = week_4.sum_harganetto2.nil? ? 0 : week_4.sum_harganetto2 %>
            <td><%= currency(@week4) %></td>
          <% end %>
          <% laporan_cabang_by_cabang.weekly_sum_value("Serenity", @first_day_week_5, @last_day_week_5).each do |week_5| %>
            <% @week5 = week_5.sum_harganetto2.nil? ? 0 : week_5.sum_harganetto2 %>
            <td><%= currency(@week5) %></td>
          <% end %>
          <% laporan_cabang_by_cabang.weekly_sum_value("Serenity", @first_day_last_month_week, @last_day_last_month_week).each do |week| %>
            <% @week_last = week.sum_harganetto2.nil? ? 0 : week.sum_harganetto2 %>
            <td><%= currency(@week_last) %></td>
          <% end %>
          <td><%= @week_last == 0 ? 0 : number_to_percentage(LaporanCabang.comparison_week(@week1, @week2, @week3, @week4, @week5,
                @week_last, get_week_number), :precision => 0) %></td>


          <% laporan_cabang_by_cabang.weekly_sum_value("Non Serenity", @first_day_week_1, @last_day_week_1).each do |week_1| %>
            <% @week1 = week_1.sum_harganetto2.nil? ? 0 : week_1.sum_harganetto2 %>
            <td><%= currency(@week1) %></td>
          <% end %>
          <% laporan_cabang_by_cabang.weekly_sum_value("Non Serenity", @first_day_week_2, @last_day_week_2).each do |week_2| %>
            <% @week2 = week_2.sum_harganetto2.nil? ? 0 : week_2.sum_harganetto2 %>
            <td><%= currency(@week2) %></td>
          <% end %>
          <% laporan_cabang_by_cabang.weekly_sum_value("Non Serenity", @first_day_week_3, @last_day_week_3).each do |week_3| %>
            <% @week3 = week_3.sum_harganetto2.nil? ? 0 : week_3.sum_harganetto2 %>
            <td><%= currency(@week3) %></td>
          <% end %>

          <% laporan_cabang_by_cabang.weekly_sum_value("Non Serenity", @first_day_week_4, @last_day_week_4).each do |week_4| %>
            <% @week4 = week_4.sum_harganetto2.nil? ? 0 : week_4.sum_harganetto2 %>
            <td><%= currency(@week4) %></td>
          <% end %>
          <% laporan_cabang_by_cabang.weekly_sum_value("Non Serenity", @first_day_week_5, @last_day_week_5).each do |week_5| %>
            <% @week5 = week_5.sum_harganetto2.nil? ? 0 : week_5.sum_harganetto2 %>
            <td><%= currency(@week5) %></td>
          <% end %>
          <% laporan_cabang_by_cabang.weekly_sum_value("Non Serenity", @first_day_last_month_week, @last_day_last_month_week).each do |week| %>
            <% @week_last = week.sum_harganetto2.nil? ? 0 : week.sum_harganetto2 %>
            <td><%= currency(@week_last) %></td>
          <% end %>
          <td><%= @week_last == 0 ? 0 : number_to_percentage(LaporanCabang.comparison_week(@week1, @week2, @week3, @week4, @week5,
                @week_last, get_week_number), :precision => 0) %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <br />
  <table id="weekly_report_sales_total" class="pretty">
    <thead>
      <tr>
        <th rowspan="3">Branches</th>
      </tr>
      <tr>
        <th colspan="7">Total</th>
        <th rowspan="2">Akumulasi</br> <%= @periode.strftime('%B %Y') %></th>
        <th rowspan="2">Akumulasi</br> <%= (@periode - 1.months).strftime('%B %Y') %></th>
        <th rowspan="2">Growth</th>
        <th rowspan="2">Target</br> <%= @periode.strftime('%B %Y') %></th>
        <th rowspan="2">ACV</th>
      </tr>
      <tr>
        <th>Week 1 </br><%= @periode.strftime('%B %Y') %></th>
        <th>Week 2 </br><%= @periode.strftime('%B %Y') %></th>
        <th>Week 3 </br><%= @periode.strftime('%B %Y') %></th>
        <th>Week 4 </br><%= @periode.strftime('%B %Y') %></th>
        <th>Week 5 </br><%= @periode.strftime('%B %Y') %></th>
        <th>Week <%= get_week_number %> </br><%= (@periode - 1.months).strftime('%B %Y') %></th>
        <th>Growth</th>
      </tr>
    </thead>
    <tfoot>
      <tr>
        <th scope="row">Total</th>
        <% (1..12).each do  %>
          <td></td>
        <% end %>
      </tr>
    </tfoot>
    <tbody>
      <% @cabang_get_id.each do |cabang| %>
        <tr>
          <% laporan_cabang_by_cabang =  cabang.laporan_cabang %>
          <th scope="row"><%= cabang.Cabang.gsub(/Cabang/, "") %></th>
          <% laporan_cabang_by_cabang.weekly_total_sum_value(["Non Serenity", "Serenity"],
            @first_day_week_1, @last_day_week_1).each do |week_1| %>
            <% @week1 = week_1.sum_harganetto2.nil? ? 0 : week_1.sum_harganetto2 %>
            <td><%= currency(@week1) %></td>
          <% end %>
          <% laporan_cabang_by_cabang.weekly_total_sum_value(["Non Serenity", "Serenity"],
            @first_day_week_2, @last_day_week_2).each do |week_2| %>
            <% @week2 = week_2.sum_harganetto2.nil? ? 0 : week_2.sum_harganetto2 %>
            <td><%= currency(@week2) %></td>
          <% end %>
          <% laporan_cabang_by_cabang.weekly_total_sum_value(["Non Serenity", "Serenity"],
            @first_day_week_3, @last_day_week_3).each do |week_3| %>
            <% @week3 = week_3.sum_harganetto2.nil? ? 0 : week_3.sum_harganetto2 %>
            <td><%= currency(@week3) %></td>
          <% end %>

          <% laporan_cabang_by_cabang.weekly_total_sum_value(["Non Serenity", "Serenity"],
            @first_day_week_4, @last_day_week_4).each do |week_4| %>
            <% @week4 = week_4.sum_harganetto2.nil? ? 0 : week_4.sum_harganetto2 %>
            <td><%= currency(@week4) %></td>
          <% end %>
          <% laporan_cabang_by_cabang.weekly_total_sum_value(["Non Serenity", "Serenity"],
            @first_day_week_5, @last_day_week_5).each do |week_5| %>
            <% @week5 = week_5.sum_harganetto2.nil? ? 0 : week_5.sum_harganetto2 %>
            <td><%= currency(@week5) %></td>
          <% end %>
          <% laporan_cabang_by_cabang.weekly_total_sum_value(["Non Serenity", "Serenity"],
            @first_day_last_month_week, @last_day_last_month_week).each do |week| %>
            <% @week_last = week.sum_harganetto2.nil? ? 0 : week.sum_harganetto2 %>
            <td><%= currency(@week_last) %></td>
          <% end %>
          <td><%= @week_last == 0 ? 0 : number_to_percentage(LaporanCabang.comparison_week(@week1, @week2, @week3, @week4, @week5,
                @week_last, get_week_number), :precision => 0) %></td>

          <% laporan_cabang_by_cabang.weekly_total_sum_value(["Non Serenity", "Serenity"],
            @periode.beginning_of_month, @periode.end_of_month).each do |month| %>
            <% @week1 = month.sum_harganetto2.nil? ? 0 : month.sum_harganetto2 %>
            <td><%= currency(@week1) %></td>
          <% end %>
          <% laporan_cabang_by_cabang.weekly_total_sum_value(["Non Serenity", "Serenity"],
            1.month.ago.beginning_of_month, 1.month.ago.end_of_month).each do |month| %>
            <% @week2 = month.sum_harganetto2.nil? ? 0 : month.sum_harganetto2 %>
            <td><%= currency(@week2) %></td>
          <% end %>
          <td><%= @week2 == 0 ? 0 : number_to_percentage((((@week1 - @week2) / @week2) * 100), :precision => 0) rescue ZeroDivisionError 0 %></td>
          <td>0</td>
          <td>0</td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <br />
  <table id="yearly_report_sales_total" class="pretty">
    <thead>
      <tr>
        <th rowspan="3">Branches</th>
      </tr>
      <tr>
        <th colspan="3">Akumulasi</th>
        <th rowspan="2">Target</br> <%= @periode.strftime('%Y') %></th>
        <th rowspan="2">ACV</br>Target <%= @periode.strftime('%Y') %></th>
      </tr>
      <tr>
        <th>Akumulasi</br> <%= @periode.beginning_of_year.strftime('%B') %> s/d <%= @periode.strftime('%B %Y') %></th>
        <th>Akumulasi</br> <%= @periode.beginning_of_year.strftime('%B') %> s/d <%= (@periode - 1.years).beginning_of_month.strftime('%B %Y') %></th>
        <th>Growth</th>
      </tr>
    </thead>
    <tfoot>
      <tr>
        <th scope="row">Total</th>
        <% (1..5).each do  %>
          <td></td>
        <% end %>
      </tr>
    </tfoot>
    <tbody>
      <% @cabang_get_id.each do |cabang| %>
        <tr>
          <% laporan_cabang_by_cabang =  cabang.laporan_cabang %>
          <th scope="row"><%= cabang.Cabang.gsub(/Cabang/, "") %></th>
          <% laporan_cabang_by_cabang.weekly_total_sum_value(["Non Serenity", "Serenity"],
            @periode.beginning_of_year, @last_day_week_5).each do |week| %>
            <% @week1 = week.sum_harganetto2.nil? ? 0 : week.sum_harganetto2 %>
            <td><%= currency(@week1) %></td>
          <% end %>
          <% laporan_cabang_by_cabang.weekly_total_sum_value(["Non Serenity", "Serenity"],
            (@periode - 1.years).beginning_of_year, @last_year_last_day_week).each do |week| %>
            <% @week2 = week.sum_harganetto2.nil? ? 0 : week.sum_harganetto2 %>
            <td><%= currency(@week2) %></td>
          <% end %>
          <td><%= @week2 == 0 ? 0 : number_to_percentage((((@week1 - @week2) / @week2) * 100), :precision => 0) rescue ZeroDivisionError 0 %></td>
          <td>0</td>
          <td>0</td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <br />
  <table id="classic_weekly_sales_report" class="pretty">
    <p>WEEKLY SALES PERFORMANCE REPORT</p>
    <p><%= @periode.strftime('%B %Y')  %></p><br />
    <p>Classic Brand</p><br />
    <thead>
      <tr>
        <th rowspan="2">Branches</th>
      </tr>
      <tr>
        <th>Week 1 </br><%= @periode.strftime('%B %Y') %></th>
        <th>Week 2 </br><%= @periode.strftime('%B %Y') %></th>
        <th>Week 3 </br><%= @periode.strftime('%B %Y') %></th>
        <th>Week 4 </br><%= @periode.strftime('%B %Y') %></th>
        <th>Week 5 </br><%= @periode.strftime('%B %Y') %></th>
        <th>Week <%= get_week_number %> </br><%= (@periode - 1.months).strftime('%B %Y') %></th>
        <th>Growth</th>
      </tr>
    </thead>
    <tfoot>
      <tr>
        <th scope="row">Total</th>
        <% (1..7).each do  %>
          <td></td>
        <% end %>
      </tr>
    </tfoot>
    <tbody>
      <% @cabang_get_id.each do |cabang| %>
        <tr>
          <% laporan_cabang_by_cabang =  cabang.laporan_cabang %>
          <th scope="row"><%= cabang.Cabang.gsub(/Cabang/, "") %></th>
          <% laporan_cabang_by_cabang.weekly_sum_value("Classic", @first_day_week_1, @last_day_week_1).each do |week_1| %>
            <% @week1 = week_1.sum_harganetto2.nil? ? 0 : week_1.sum_harganetto2 %>
            <td><%= currency(@week1) %></td>
          <% end %>
          <% laporan_cabang_by_cabang.weekly_sum_value("Classic", @first_day_week_2, @last_day_week_2).each do |week_2| %>
            <% @week2 = week_2.sum_harganetto2.nil? ? 0 : week_2.sum_harganetto2 %>
            <td><%= currency(@week2) %></td>
          <% end %>
          <% laporan_cabang_by_cabang.weekly_sum_value("Classic", @first_day_week_3, @last_day_week_3).each do |week_3| %>
            <% @week3 = week_3.sum_harganetto2.nil? ? 0 : week_3.sum_harganetto2 %>
            <td><%= currency(@week3) %></td>
          <% end %>

          <% laporan_cabang_by_cabang.weekly_sum_value("Classic", @first_day_week_4, @last_day_week_4).each do |week_4| %>
            <% @week4 = week_4.sum_harganetto2.nil? ? 0 : week_4.sum_harganetto2 %>
            <td><%= currency(@week4) %></td>
          <% end %>
          <% laporan_cabang_by_cabang.weekly_sum_value("Classic", @first_day_week_5, @last_day_week_5).each do |week_5| %>
            <% @week5 = week_5.sum_harganetto2.nil? ? 0 : week_5.sum_harganetto2 %>
            <td><%= currency(@week5) %></td>
          <% end %>
          <% laporan_cabang_by_cabang.weekly_sum_value("Classic", @first_day_last_month_week, @last_day_last_month_week).each do |week| %>
            <% @week_last = week.sum_harganetto2.nil? ? 0 : week.sum_harganetto2 %>
            <td><%= currency(@week_last) %></td>
          <% end %>
          <td><%= @week_last == 0 ? 0 : number_to_percentage(LaporanCabang.comparison_week(@week1, @week2, @week3, @week4, @week5,
                @week_last, get_week_number), :precision => 0) %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>
