<h2 style="font-size: 17px; position: absolute; left: 444px;"><i>Sales Report by Brand Period <%= params[:from].to_date.strftime("%e %B %Y") %> - <%= params[:to].to_date.strftime("%e %B %Y") %></i></h2>
<br />

<table>
  <thead>
    <tr>
      <th rowspan="3">Brand</th>
    </tr>
    <tr>
      <% Cabang.get_id.each do |cabang| %>
        <th colspan="2"><%= cabang.Cabang.gsub(/Cabang/, "") %></th>
      <% end %>
    </tr>
    <tr>
      <% (1..7).each do %>
        <th>Qty</th>
        <th>Value</th>
      <% end %>
    </tr>
  </thead>
  <tfoot>
    <tr>
      <th scope="row">Total</th>
      <% (1..14).each do  %>
        <td></td>
      <% end %>
    </tr>
  </tfoot>
  <tbody>
    <% Merk.all.each do |merk| %>
      <tr>
        <% if merk.Merk == current_user.user_brand %>
          <td><%= merk.Merk %></td>
        <% elsif current_user.user_brand == "Admin" %>
          <td><%= merk.Merk %></td>
        <% else %>
          <td><%= merk.Merk %></td>
        <% end %>

        <!-- Bandung -->
        <% if current_user.user_brand == merk.Merk || current_user.user_brand.slice(0) == "A" %>
          <% LaporanCabang.sum_of_brand(2, current_user.user_brand.slice(0) == "A" ? merk.Merk : current_user.user_brand.slice(0),
            params[:from], params[:to]).each do |a| %>
            <td><%= a.sum_jumlah.nil? ? "0" : a.sum_jumlah.to_i %></td>
            <td><%= a.sum_harganetto2.nil? ? "0" : currency(a.sum_harganetto2) %></td>
          <% end %>
        <% else %>
          <td>0</td>
          <td>0</td>
        <% end %>
        <!-- Narogong -->
        <% if current_user.user_brand == merk.Merk || current_user.user_brand.slice(0) == "A" %>
          <% LaporanCabang.sum_of_brand(3, current_user.user_brand.slice(0) == "A" ? merk.Merk : current_user.user_brand.slice(0),
            params[:from], params[:to]).each do |a| %>
            <td><%= a.sum_jumlah.nil? ? "0" : a.sum_jumlah.to_i %></td>
            <td><%= a.sum_harganetto2.nil? ? "0" : currency(a.sum_harganetto2) %></td>
          <% end %>
        <% else %>
          <td>0</td>
          <td>0</td>
        <% end %>
        <!-- Bali -->
        <% if current_user.user_brand == merk.Merk || current_user.user_brand.slice(0) == "A" %>
          <% LaporanCabang.sum_of_brand(4, current_user.user_brand.slice(0) == "A" ? merk.Merk : current_user.user_brand.slice(0),
            params[:from], params[:to]).each do |a| %>
            <td><%= a.sum_jumlah.nil? ? "0" : a.sum_jumlah.to_i %></td>
            <td><%= a.sum_harganetto2.nil? ? "0" : currency(a.sum_harganetto2) %></td>
          <% end %>
        <% else %>
          <td>0</td>
          <td>0</td>
        <% end %>
        <!-- Medan -->
        <% if current_user.user_brand == merk.Merk || current_user.user_brand.slice(0) == "A" %>
          <% LaporanCabang.sum_of_brand(5, current_user.user_brand.slice(0) == "A" ? merk.Merk : current_user.user_brand.slice(0),
            params[:from], params[:to]).each do |a| %>
            <td><%= a.sum_jumlah.nil? ? "0" : a.sum_jumlah.to_i %></td>
            <td><%= a.sum_harganetto2.nil? ? "0" : currency(a.sum_harganetto2) %></td>
          <% end %>
        <% else %>
          <td>0</td>
          <td>0</td>
        <% end %>
        <!-- Surabaya -->
        <% if current_user.user_brand == merk.Merk || current_user.user_brand.slice(0) == "A" %>
          <% LaporanCabang.sum_of_brand(7, current_user.user_brand.slice(0) == "A" ? merk.Merk : current_user.user_brand.slice(0),
            params[:from], params[:to]).each do |a| %>
            <td><%= a.sum_jumlah.nil? ? "0" : a.sum_jumlah.to_i %></td>
            <td><%= a.sum_harganetto2.nil? ? "0" : currency(a.sum_harganetto2) %></td>
          <% end %>
        <% else %>
          <td>0</td>
          <td>0</td>
        <% end %>
        <!-- Semarang -->
        <% if current_user.user_brand == merk.Merk || current_user.user_brand.slice(0) == "A" %>
          <% LaporanCabang.sum_of_brand(8, current_user.user_brand.slice(0) == "A" ? merk.Merk : current_user.user_brand.slice(0),
            params[:from], params[:to]).each do |a| %>
            <td><%= a.sum_jumlah.nil? ? "0" : a.sum_jumlah.to_i %></td>
            <td><%= a.sum_harganetto2.nil? ? "0" : currency(a.sum_harganetto2) %></td>
          <% end %>
        <% else %>
          <td>0</td>
          <td>0</td>
        <% end %>
        <!-- Cirebon -->
        <% if current_user.user_brand == merk.Merk || current_user.user_brand.slice(0) == "A" %>
          <% LaporanCabang.sum_of_brand(9, current_user.user_brand.slice(0) == "A" ? merk.Merk : current_user.user_brand.slice(0),
            params[:from], params[:to]).each do |a| %>
            <td><%= a.sum_jumlah.nil? ? "0" : a.sum_jumlah.to_i %></td>
            <td><%= a.sum_harganetto2.nil? ? "0" : currency(a.sum_harganetto2) %></td>
          <% end %>
        <% else %>
          <td>0</td>
          <td>0</td>
        <% end %>
        <!-- Yogyakarta -->
        <% if current_user.user_brand == merk.Merk || current_user.user_brand.slice(0) == "A" %>
          <% LaporanCabang.sum_of_brand(10, current_user.user_brand.slice(0) == "A" ? merk.Merk : current_user.user_brand.slice(0),
            params[:from], params[:to]).each do |a| %>
            <td><%= a.sum_jumlah.nil? ? "0" : a.sum_jumlah.to_i %></td>
            <td><%= a.sum_harganetto2.nil? ? "0" : currency(a.sum_harganetto2) %></td>
          <% end %>
        <% else %>
          <td>0</td>
          <td>0</td>
        <% end %>
        <!-- Palembang -->
        <% if current_user.user_brand == merk.Merk || current_user.user_brand.slice(0) == "A" %>
          <% LaporanCabang.sum_of_brand(11, current_user.user_brand.slice(0) == "A" ? merk.Merk : current_user.user_brand.slice(0),
            params[:from], params[:to]).each do |a| %>
            <td><%= a.sum_jumlah.nil? ? "0" : a.sum_jumlah.to_i %></td>
            <td><%= a.sum_harganetto2.nil? ? "0" : currency(a.sum_harganetto2) %></td>
          <% end %>
        <% else %>
          <td>0</td>
          <td>0</td>
        <% end %>
        <!-- Lampung -->
        <% if current_user.user_brand == merk.Merk || current_user.user_brand.slice(0) == "A" %>
          <% LaporanCabang.sum_of_brand(13, current_user.user_brand.slice(0) == "A" ? merk.Merk : current_user.user_brand.slice(0),
            params[:from], params[:to]).each do |a| %>
            <td><%= a.sum_jumlah.nil? ? "0" : a.sum_jumlah.to_i %></td>
            <td><%= a.sum_harganetto2.nil? ? "0" : currency(a.sum_harganetto2) %></td>
          <% end %>
        <% else %>
          <td>0</td>
          <td>0</td>
        <% end %>
        <!-- Makasar -->
        <% if current_user.user_brand == merk.Merk || current_user.user_brand.slice(0) == "A" %>
          <% LaporanCabang.sum_of_brand(19, current_user.user_brand.slice(0) == "A" ? merk.Merk : current_user.user_brand.slice(0),
            params[:from], params[:to]).each do |a| %>
            <td><%= a.sum_jumlah.nil? ? "0" : a.sum_jumlah.to_i %></td>
            <td><%= a.sum_harganetto2.nil? ? "0" : currency(a.sum_harganetto2) %></td>
          <% end %>
        <% else %>
          <td>0</td>
          <td>0</td>
        <% end %>
        <!-- Pekanbaru -->
        <% if current_user.user_brand == merk.Merk || current_user.user_brand.slice(0) == "A" %>
          <% LaporanCabang.sum_of_brand(20, current_user.user_brand.slice(0) == "A" ? merk.Merk : current_user.user_brand.slice(0),
            params[:from], params[:to]).each do |a| %>
            <td><%= a.sum_jumlah.nil? ? "0" : a.sum_jumlah.to_i %></td>
            <td><%= a.sum_harganetto2.nil? ? "0" : currency(a.sum_harganetto2) %></td>
          <% end %>
        <% else %>
          <td>0</td>
          <td>0</td>
        <% end %>
        <!-- Jember -->
        <% if current_user.user_brand == merk.Merk || current_user.user_brand.slice(0) == "A" %>
          <% LaporanCabang.sum_of_brand(22, current_user.user_brand.slice(0) == "A" ? merk.Merk : current_user.user_brand.slice(0),
            params[:from], params[:to]).each do |a| %>
            <td><%= a.sum_jumlah.nil? ? "0" : a.sum_jumlah.to_i %></td>
            <td><%= a.sum_harganetto2.nil? ? "0" : currency(a.sum_harganetto2) %></td>
          <% end %>
        <% else %>
          <td>0</td>
          <td>0</td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
</br>
<table id="group_by_cabang_total" class="display">
  <thead>
    <tr>
      <th rowspan="2">Brand</th>
      <th colspan="2">Total</th>
    </tr>
    <tr>
      <th>Qty</th>
      <th>Value</th>
    </tr>
  </thead>
  <tfoot>
  </tfoot>
  <tbody>
    <% Merk.all.each do |merk| %>
      <tr>
        <td><%= merk.Merk %></td>
        <% if current_user.user_brand == merk.Merk || current_user.user_brand.slice(0) == "A" %>
          <% LaporanCabang.total_on_merk(merk.Merk, params[:from], params[:to]).each do |a| %>
            <td><%= a.sum_jumlah.nil? ? "0" : a.sum_jumlah.to_i %></td>
            <td><%= a.sum_harganetto2.nil? ? "0" : currency(a.sum_harganetto2) %></td>
          <% end %>
        <% else %>
          <td>0</td>
          <td>0</td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
