<div class="row-fluid">
  <div class="offset5">
    <div class="block-content collapse in">
      <h2 style="font-size: 17px;"><i>Quick View Sales Report</i></h2>
    </div>
  </div>
</div>
<div class="row-fluid">
  <div class="offset0">
    <div class="span5">
      <!-- block -->
      <div class="block">
        <div class="navbar navbar-inner block-header">
          <div class="muted pull-left">Search Parameters</div>
          <div class="pull-right"><span class="badge badge-info"></span>

          </div>
        </div>
        <div class="block-content collapse in">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Brand</th>
                <th>Type</th>
                <th>Article</th>
                <th>Fabric</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><%= params[:brand].nil? ? "" : params[:brand] %></td>
                <td><%= params[:type].nil? ? "" : params[:type] %></td>
                <td><%= params[:article].nil? ? "" : Artikel.artikel_name(params[:article]).first.Produk %></td>
                <td><%= params[:fabric].nil? ? "" : Kain.kain_name_from_code(params[:fabric]).first.NamaKain %></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <!-- /block -->
    </div>
  </div>
</div>
<div class="row-fluid">
  <div class="block-content collapse in">
    <label>
      <%= link_to 'Export to Excel', url_for(:format => 'xls', :from => params[:from], :group_by => params[:group_by],
        :to => params[:to], :brand => params[:brand], :type => params[:type], :article => params[:article], :fabric => params[:fabric],
        :size_type => params[:size_type]), 
        :class=>"btn btn-info" %>
    </label>
  </div>
</div>
<br />
<div class="row-fluid">
  <div class="block-content collapse in">
    <table id="quick_report" border="1" class="display" cellspacing="0" cellpadding="3" width="100%">
      <thead>
        <tr>
          <th rowspan="3">Branch</th>
        </tr>
        <tr>
          <th colspan="2"><%= 3.month.ago.strftime("%B") %></th>
          <th colspan="2"><%= 2.month.ago.strftime("%B") %></th>
          <th colspan="2"><%= 1.month.ago.strftime("%B") %></th>
          <th colspan="2"><%= Date.today.strftime("%B") %></th>
        </tr>
        <tr>
          <% (1..4).each do %>
            <th>Qty</th>
            <th>Value</th>
          <% end %>
        </tr>
      </thead>
      <tfoot>
        <tr>
          <th scope="row">Total</th>
          <% (1..8).each do  %>
            <td></td>
          <% end %>
        </tr>
      </tfoot>
      <tbody>
        <% @customerstore.each do |laporan| %>
          <tr>
            <td><%= Cabang.find_by_id(laporan.cabang).Cabang.gsub(/Cabang/,'') %></td>

            <!-- January -->
            <% if LaporanCabang.customer_monthly(3.month.ago.month, Date.today.year, laporan.cabang, nil, 
                params[:brand], nil, nil, nil, nil, nil, nil, 
                nil, nil).empty? %>
              <td>0</td>
              <td>0</td>
            <% else %>
              <% LaporanCabang.customer_monthly(3.month.ago.month, Date.today.year, laporan.cabang, params[:type], 
                params[:brand], params[:article], nil, params[:fabric], params[:size], params[:customer], params[:size_type], 
                params[:customer_modern], params[:customer_all_retail]).each do |a| %>
                <td><%= a.sum_jumlah.nil? ? "0" : a.sum_jumlah.to_i %></td>
                <td><%= a.sum_harganetto2.nil? ? "0" : currency(a.sum_harganetto2) %></td>
              <% end %>
            <% end %>


            <% if LaporanCabang.customer_monthly(2.month.ago.month, Date.today.year, laporan.cabang, params[:type], 
                params[:brand], params[:article], nil, params[:fabric], params[:size], params[:customer], params[:size_type], 
                params[:customer_modern], params[:customer_all_retail]).empty? %>
              <td>0</td>
              <td>0</td>
            <% else %>
              <% LaporanCabang.customer_monthly(2.month.ago.month, Date.today.year, laporan.cabang, params[:type], 
                params[:brand], params[:article], nil, params[:fabric], params[:size], params[:customer], params[:size_type], 
                params[:customer_modern], params[:customer_all_retail]).each do |a| %>
                <td><%= a.sum_jumlah.nil? ? "0" : a.sum_jumlah.to_i %></td>
                <td><%= a.sum_harganetto2.nil? ? "0" : currency(a.sum_harganetto2) %></td>
              <% end %>
            <% end %>


            <% if LaporanCabang.customer_monthly(1.month.ago.month, Date.today.year, laporan.cabang, params[:type], 
                params[:brand], params[:article], nil, params[:fabric], params[:size], params[:customer], params[:size_type], 
                params[:customer_modern], params[:customer_all_retail]).empty? %>
              <td>0</td>
              <td>0</td>
            <% else %>
              <% LaporanCabang.customer_monthly(1.month.ago.month, Date.today.year, laporan.cabang, params[:type], 
                params[:brand], params[:article], nil, params[:fabric], params[:size], params[:customer], params[:size_type], 
                params[:customer_modern], params[:customer_all_retail]).each do |a| %>
                <td><%= a.sum_jumlah.nil? ? "0" : a.sum_jumlah.to_i %></td>
                <td><%= a.sum_harganetto2.nil? ? "0" : currency(a.sum_harganetto2) %></td>
              <% end %>
            <% end %>


            <% if LaporanCabang.customer_monthly(Date.today.month, Date.today.year, laporan.cabang, params[:type], 
                params[:brand], params[:article], nil, params[:fabric], params[:size], params[:customer], params[:size_type], 
                params[:customer_modern], params[:customer_all_retail]).empty? %>
              <td>0</td>
              <td>0</td>
            <% else %>
              <% LaporanCabang.customer_monthly(Date.today.month, Date.today.year, laporan.cabang, params[:type], 
                params[:brand], params[:article], nil, params[:fabric], params[:size], params[:customer], params[:size_type], 
                params[:customer_modern], params[:customer_all_retail]).each do |a| %>
                <td><%= a.sum_jumlah.nil? ? "0" : a.sum_jumlah.to_i %></td>
                <td><%= a.sum_harganetto2.nil? ? "0" : currency(a.sum_harganetto2) %></td>
              <% end %>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

