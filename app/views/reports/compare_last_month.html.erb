<% if params[:group_by] == 'customer' %>
<% unless params[:from].nil? %>
  <% unless params[:from].empty? %>
		<div class="offset2">
			<div class="form-inline">
		    <label id="customer"></label>
		    <label id="artikel" ></label>
		    <label id="kodebrg"></label>
		    <label id="kain"></label>
			</div>
		</div>
    <br />
		<div class="offset1">
		    <label>Brand : <%= Merk.merk_name(params[:brand]).first.Merk %></label>
		    <label>Type : <%= params[:type].nil? ? "" : Product.product_name(params[:type]).first.Namaroduk %></label>
		    <label>Article : <%= params[:article].nil? ? "" : Artikel.artikel_name(params[:article]).first.Produk %></label>
		    <label>Fabric : <%= params[:fabric].nil? ? "" : Kain.kain_name_from_code(params[:fabric]).first.NamaKain %></label>
		    <label>Size Type : <%= params[:size_type] == 'T' ? 'Special Size' : 'Standard Size' %></label>
		    <label>Group By : <%= params[:group_by] %></label>
		</div>
		<div class="offset8">
			<label>If you want to repeat your filter, please click <%= link_to 'New Filter', 
				reports_first_filter_path, {:class => "btn btn-primary"} %> 
			</label>
		</div>
		<br />
		<table id="customer_monthly" class="pretty">
		  <thead>
		    <tr>
						<% if params[:group_by] == 'customer' %>
		        	<th rowspan="3">Customer</th>
						<% elsif params[:group_by] == 'article' %>
		        	<th rowspan="3">Article</th>
						<% else %>
		        	<th rowspan="3">Items Code</th>
						<% end %>
		      <th rowspan="3">City</th>
		      <th colspan="6">Comparison</th>
		    </tr>
		    <tr>
		      <th colspan="2"><%= (params[:to].to_date - 1.month).strftime('%B')  %></th>
		      <th colspan="2"><%= params[:to].to_date.strftime('%B')  %></th>
					<th colspan="2">Growth</th>
		    </tr>
		    <tr>
				<% (1..3).each do |a| %>
		      <th>QTY</th>
		      <th>Value</th>
				<% end %>
		    </tr>
		  </thead>
		  <tfoot>
		  </tfoot>
		  <tbody>
		    <% @customerstore.each do |laporan| %>
		      <tr>
						<% if params[:group_by] == 'customer' %>
		        	<td><%= laporan.customer %></td>
						<% elsif params[:group_by] == 'article' %>
		        	<td><%= laporan.artikel %></td>
						<% else %>
		        	<td><%= laporan.kodebrg %></td>
						<% end %>
		        <th scope="row"><%= laporan.kota %></th>
							<% LaporanCabang.select("sum(jumlah) as sum_jumlah, customer, 
								sum(harganetto2) as sum_harga, kota")
								.between_date_sales(@from_last_month, @to_last_month).search_by_branch(laporan.cabang)
								.search_by_type(params[:type]).brand(params[:brand]).kode_barang_like(params[:article])
								.fabric(laporan.kodekain).size_length(params[:size]).customer_analyze(laporan.customer)
								.brand_size(params[:size_type]).group(params[:group_by]).each do |a| %>
								<% @value_last = a.sum_harga.nil? ? 0 : a.sum_harga %>
              	<td><%= @qty_last = a.sum_jumlah.nil? ? 0 : a.sum_jumlah.to_i %></td>
              	<td><%= currency(@value_last) %></td>
							<% end %>
							<% @value_current = laporan.sum_harga.nil? ? 0 : laporan.sum_harga %>
              <td><%= @qty_current = laporan.sum_jumlah.nil? ? 0 : laporan.sum_jumlah.to_i %></td>
              <td><%= currency(@value_current) %></td>
							<td><%= number_to_percentage(LaporanCabang.growth(@qty_last, @qty_current), :precision => 2) %></td>
							<td><%= number_to_percentage(LaporanCabang.growth(@value_last, @value_current), :precision => 2) %></td>
		      </tr>
		    <% end %>
		  </tbody>
		</table>
	<% end %>
<% end %>
<% end %>

<% if params[:group_by] == 'kodebrg' %>
 <% unless params[:from].nil? %>
  <% unless params[:from].empty? %>
		<div class="offset2">
			<div class="form-inline">
		    <label id="customer"></label>
		    <label id="artikel" ></label>
		    <label id="kodebrg"></label>
		    <label id="kain"></label>
			</div>
		</div>
    <br />
		<div class="offset1">
		    <label>Brand : <%= Merk.merk_name(params[:brand]).first.Merk %></label>
		    <label>Type : <%= params[:type].nil? ? "" : Product.product_name(params[:type]).first.Namaroduk %></label>
		    <label>Article : <%= params[:article].nil? ? "" : Artikel.artikel_name(params[:article]).first.Produk %></label>
		    <label>Fabric : <%= params[:fabric].nil? ? "" : Kain.kain_name_from_code(params[:fabric]).first.NamaKain %></label>
		    <label>Size Type : <%= params[:size_type] == 'T' ? 'Special Size' : 'Standard Size' %></label>
		    <label>Group By : <%= params[:group_by] %></label>
		</div>
		<div class="offset8">
			<label>If you want to repeat your filter, please click <%= link_to 'New Filter', 
				reports_first_filter_path, {:class => "btn btn-primary"} %> 
			</label>
		</div>
		<br />
		<table id="customer_monthly" class="pretty">
		  <thead>
		    <tr>
						<% if params[:group_by] == 'customer' %>
		        	<th rowspan="3">Customer</th>
						<% elsif params[:group_by] == 'article' %>
		        	<th rowspan="3">Article</th>
						<% else %>
		        	<th rowspan="3">Items Code</th>
						<% end %>
		      <th rowspan="3">City</th>
		      <th colspan="6">Comparison</th>
		    </tr>
		    <tr>
		      <th colspan="2"><%= (params[:to].to_date - 1.month).strftime('%B')  %></th>
		      <th colspan="2"><%= params[:to].to_date.strftime('%B')  %></th>
					<th colspan="2">Growth</th>
		    </tr>
		    <tr>
				<% (1..3).each do |a| %>
		      <th>QTY</th>
		      <th>Value</th>
				<% end %>
		    </tr>
		  </thead>
		  <tfoot>
		  </tfoot>
		  <tbody>
		    <% @customerstore.each do |laporan| %>
		      <tr>
						<% if params[:group_by] == 'customer' %>
		        	<td><%= laporan.customer %></td>
						<% elsif params[:group_by] == 'article' %>
		        	<td><%= laporan.artikel %></td>
						<% else %>
		        	<td><%= laporan.kodebrg %></td>
						<% end %>
		        <th scope="row"><%= laporan.kota %></th>
							<% LaporanCabang.select("sum(jumlah) as sum_jumlah, customer, 
								sum(harganetto2) as sum_harga, kota")
								.between_date_sales(@from_last_month, @to_last_month).search_by_branch(laporan.cabang).kode_barang_like(laporan.kodebrg)
								.search_by_type(params[:type]).brand(params[:brand]).kode_barang_like(params[:article])
								.fabric(params[:fabric]).size_length(params[:size]).customer_analyze(params[:customer])
								.brand_size(params[:size_type]).each do |a| %>
								<% @value_last = a.sum_harga.nil? ? 0 : a.sum_harga %>
              	<td><%= @qty_last = a.sum_jumlah.nil? ? 0 : a.sum_jumlah.to_i %></td>
              	<td><%= currency(@value_last) %></td>
							<% end %>
							<% @value_current = laporan.sum_harga.nil? ? 0 : laporan.sum_harga %>
              <td><%= @qty_current = laporan.sum_jumlah.nil? ? 0 : laporan.sum_jumlah.to_i %></td>
              <td><%= currency(@value_current) %></td>
							<td><%= number_to_percentage(LaporanCabang.growth(@qty_last, @qty_current), :precision => 2) %></td>
							<td><%= number_to_percentage(LaporanCabang.growth(@value_last, @value_current), :precision => 2) %></td>
		      </tr>
		    <% end %>
		  </tbody>
		</table>
	<% end %>
 <% end %>
<% end %>

<% if params[:group_by] == 'kodeartikel' %>
 <% unless params[:from].nil? %>
  <% unless params[:from].empty? %>
		<div class="offset2">
			<div class="form-inline">
		    <label id="customer"></label>
		    <label id="artikel" ></label>
		    <label id="kodebrg"></label>
		    <label id="kain"></label>
			</div>
		</div>
    <br />
		<div class="offset1">
		    <label>Brand : <%= Merk.merk_name(params[:brand]).first.Merk %></label>
		    <label>Type : <%= params[:type].nil? ? "" : Product.product_name(params[:type]).first.Namaroduk %></label>
		    <label>Article : <%= params[:article].nil? ? "" : Artikel.artikel_name(params[:article]).first.Produk %></label>
		    <label>Fabric : <%= params[:fabric].nil? ? "" : Kain.kain_name_from_code(params[:fabric]).first.NamaKain %></label>
		    <label>Size Type : <%= params[:size_type] == 'T' ? 'Special Size' : 'Standard Size' %></label>
		    <label>Group By : <%= params[:group_by] %></label>
		</div>
		<div class="offset8">
			<label>If you want to repeat your filter, please click <%= link_to 'New Filter', 
				reports_first_filter_path, {:class => "btn btn-primary"} %> 
			</label>
		</div>
		<br />
		<table id="customer_monthly" class="pretty">
		  <thead>
		    <tr>
						<% if params[:group_by] == 'customer' %>
		        	<th rowspan="3">Customer</th>
						<% elsif params[:group_by] == 'kodeartikel' %>
		        	<th rowspan="3">Article</th>
						<% else %>
		        	<th rowspan="3">Items Code</th>
						<% end %>
		      <th rowspan="3">City</th>
		      <th colspan="6">Comparison</th>
		    </tr>
		    <tr>
		      <th colspan="2"><%= (params[:to].to_date - 1.month).strftime('%B')  %></th>
		      <th colspan="2"><%= params[:to].to_date.strftime('%B')  %></th>
					<th colspan="2">Growth</th>
		    </tr>
		    <tr>
				<% (1..3).each do |a| %>
		      <th>QTY</th>
		      <th>Value</th>
				<% end %>
		    </tr>
		  </thead>
		  <tfoot>
		  </tfoot>
		  <tbody>
		    <% @customerstore.each do |laporan| %>
		      <tr>
						<% if params[:group_by] == 'customer' %>
		        	<td><%= laporan.customer %></td>
						<% elsif params[:group_by] == 'kodeartikel' %>
		        	<td><%= Artikel.artikel_name(params[:article]).first.Produk %></td>
						<% else %>
		        	<td><%= laporan.kodebrg %></td>
						<% end %>
		        <th scope="row"><%= laporan.kota %></th>
							<% LaporanCabang.select("sum(jumlah) as sum_jumlah, customer, 
								sum(harganetto2) as sum_harga")
								.between_date_sales(@from_last_month, @to_last_month).search_by_branch(laporan.cabang).kode_barang_like(laporan.kodeartikel)
								.search_by_type(params[:type]).brand(params[:brand])
								.fabric(params[:fabric]).size_length(params[:size]).customer_analyze(params[:customer])
								.brand_size(params[:size_type]).each do |a| %>
								<% @value_last = a.sum_harga.nil? ? 0 : a.sum_harga %>
              	<td><%= @qty_last = a.sum_jumlah.nil? ? 0 : a.sum_jumlah.to_i %></td>
              	<td><%= currency(@value_last) %></td>
							<% end %>
							<% @value_current = laporan.sum_harga.nil? ? 0 : laporan.sum_harga %>
              <td><%= @qty_current = laporan.sum_jumlah.nil? ? 0 : laporan.sum_jumlah.to_i %></td>
              <td><%= currency(@value_current) %></td>
							<td><%= number_to_percentage(LaporanCabang.growth(@qty_last, @qty_current), :precision => 2) %></td>
							<td><%= number_to_percentage(LaporanCabang.growth(@value_last, @value_current), :precision => 2) %></td>
		      </tr>
		    <% end %>
		  </tbody>
		</table>
	<% end %>
 <% end %>
<% end %>
