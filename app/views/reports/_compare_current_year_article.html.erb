<div class="row-fluid">
  <div class="offset4">
    <div class="block-content collapse in">
      <h2 style="font-size: 17px;"><i>Sales Comparison Report Period <%= params[:from].to_date.strftime("%e %B %Y") %> - <%= params[:to].to_date.strftime("%e %B %Y") %></i></h2>
    </div>
  </div>
</div>
<div class="row-fluid">
  <div class="offset0">
    <div class="span5">
      <!-- block -->
      <div class="block">
        <div class="navbar navbar-inner block-header">
          <div class="muted pull-left">Search Parameters</div>
          <div class="pull-right"><span class="badge badge-info"></span>

          </div>
        </div>
        <div class="block-content collapse in">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Brand</th>
                <th>Type</th>
                <th>Article</th>
                <th>Group</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><%= brand.nil? ? "" : brand.join(',').to_s %></td>
                <td><%= type.nil? ? "" : type.join(',').to_s %></td>
                <td><%= article.nil? ? "" : article %></td>
                <td>Article</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <!-- /block -->
    </div>
  </div>
</div>
<div class="row-fluid">
  <div class="offset7">
    <div class="block-content collapse in">
      <label>If you want to repeat your filter, please click <%= link_to 'New Filter', 
          reports_first_filter_path, {:class => "btn btn-primary"} %> or change your 
        <a href="#myModal" role="button" class="btn btn-primary" data-toggle="modal">Grouping & Compare by</a>
        <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
          <%= render 'group_compare' %>
        </div>
      </label>
    </div>
  </div>
</div>
<div class="row-fluid">
  <div class="block-content collapse in">
    <label>
      <%= link_to 'Export to Excel', url_for(:format => 'xls', :from => params[:from], :group_by => params[:group_by], :to => params[:to], :brand => params[:brand], :type => params[:type], :article => params[:article], :fabric => params[:fabric], :size_type => params[:size_type], :branch => params[:branch]), 
        :class=>"btn btn-info" %>
    </label>
  </div>
</div>
<br />
<div class="row-fluid">
  <div class="block-content collapse in">
    <table id="cus_compare" border="1" class="display" cellspacing="0" cellpadding="3" width="100%">
      <thead>
        <tr>
          <th rowspan="3">Cabang</th>
          <th rowspan="3">Jenis</th>
          <th rowspan="3">Article</th>
        </tr>
        <tr>
          <% @month_devided.each do |month, sales|  %>
            <th colspan="2"><%= month.strftime('%B') %></th>
          <% end %>
        </tr>
        <tr>
          <% @month_devided.each do |month, sales| %>
            <th>Qty</th>
            <th>Val</th>
          <% end %>
        </tr>
      </thead>
      <tfoot>
      </tfoot>
      <tbody>
        <% @article.each do |laporan| %>
          <tr>
            <td><%= Cabang.find_by_id(laporan.cabang_id).Cabang.gsub(/Cabang/,'') %></td>
            <td><%= laporan.produk %></td>
            <td><%= laporan.artikel %></td>
            <td><%= laporan.sum_jumlah.nil? ? "0" : laporan.sum_jumlah.to_i %></td>
            <td><%= laporan.sum_harganetto2.nil? ? "0" : currency(laporan.sum_harganetto2) %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
</br>
<% if (params[:from].to_date..params[:to].to_date).to_a.group_by(&:month).count > 6  %>
  <div class="row-fluid">
    <div class="block-content collapse in">
      <table id="cus_compare2" border="1" class="display" cellspacing="0" cellpadding="3" width="100%">
        <thead>
          <tr>
            <th rowspan="3">Cabang</th>
            <th rowspan="3">Jenis</th>
            <th rowspan="3">Article</th>
          </tr>
          <tr>
            <% @over_month.each do |month, sales|  %>
              <th colspan="2"><%= month.strftime('%B') %></th>
            <% end %>
          </tr>
          <tr>
            <% @over_month.each do |month, sales| %>
              <th>Qty</th>
              <th>Val</th>
            <% end %>
          </tr>
        </thead>
        <tfoot>
        </tfoot>
        <tbody>
          <% @article.each do |laporan|	 %>
            <tr>
              <td><%= Cabang.find_by_id(laporan.cabang_id).Cabang.gsub(/Cabang/,'') %></td>
              <td><%= laporan.merk %></td>
              <td><%= laporan.artikel %></td>
              <% @over_month.each do |month, sales| %>
                <% if Date.today.strftime('%d').to_i <= 15 %>
                  <% if month.month == Date.today.strftime('%-m').to_i || month.month == Date.today.strftime('%-m').to_i - 1  %>
                    <% @model = TmpArticle %>
                  <% else %>
                    <% @model = SalesArticle %>
                  <% end %>
                <% else %>
                  <% if month.month == Date.today.strftime('%-m').to_i  %>
                    <% @model = TmpArticle %>
                  <% else %>
                    <% @model = SalesArticle %>
                  <% end %>
                <% end %>

                <!-- January -->
                <% if @model.customer_monthly(month.month, month.year, laporan.cabang_id, laporan.produk, 
                    laporan.merk, laporan.artikel, nil, fabric, size, customer, size_type, 
                    customer_modern, customer_all_retail).empty? %>
                  <td>0</td>
                  <td>0</td>
                <% else %>
                  <% @model.customer_monthly(month.month, month.year, laporan.cabang_id, laporan.produk, 
                    laporan.merk, laporan.artikel, nil, fabric, size, customer, size_type, 
                    customer_modern, customer_all_retail).each do |a| %>
                    <td><%= a.sum_jumlah.nil? ? "0" : a.sum_jumlah.to_i %></td>
                    <td><%= a.sum_harganetto2.nil? ? "0" : currency(a.sum_harganetto2) %></td>
                  <% end %>
                <% end %>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
<% end %>
